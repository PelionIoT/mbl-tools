{% extends "shared/templates/base.yaml" %}

{% set job_name = "Core Component Tests" %}
{% set lxc_creation = false %}

{% block testplan %}
- test:
    timeout:
      minutes: 20
    namespace: target
    definitions:
    {{ macros.mbl_test_dependency() | indent }}

    {# Use the correct ipk depending on architecture. #}
    {% if device_type in  ["imx8mmevk-mbl"] %}
        {# For the arm64 devices get the correct ipk. #}
        {% set am_setup = "mv /scratch/app-lifecycle-manager-test-package_1.0_any.ipk.arm64 /scratch/app-lifecycle-manager-test-package_1.0_any.ipk" %}
    {% else %}
        {# For all else use the default. #}
        {% set am_setup = "" %}
    {% endif %}
    {{ macros.mbl_component_test("application-framework", am_setup) | indent }}

    {{ macros.mbl_component_test("cloud-services") | indent }}

    {% set fm_setup = "python3 firmware-management/mbl-app-manager/tests/native/test_case_generator_mbl-app-manager.py -o /home/app -v" %}
    {% set fm_teardown = "/bin/rm -rf /home/app/*" %}
    {{ macros.mbl_component_test("firmware-management", fm_setup, fm_teardown) | indent }}

    {{ macros.mbl_component_test("management-agents") | indent }}

    {{ macros.mbl_component_test("mbl-core") | indent }}

    {{ macros.mbl_component_test("platform-services") | indent }}

    {{ macros.mbl_component_test("secure-services") | indent }}
{% endblock testplan %}
