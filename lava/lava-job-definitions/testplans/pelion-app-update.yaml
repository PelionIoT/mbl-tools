{% extends "shared/templates/base.yaml" %}

{% set job_name = "Pelion App Update" %}
{% set lxc_creation = true %}
{% set lxc_name = "pelion-app-update-lxc" %}

{% block testplan %}
- test:
    timeout:
      minutes: 50
    namespace: lxc
    definitions:
    {{ macros.mbl_avahi_discovery_test() | indent }}

    {{ macros.install_mbl_cli() | indent }}

    {{ macros.enable_wifi() | indent }}

    {{ macros.install_docker() | indent }}

    - path: ci/lava/tests/lxc-build-helloworld.yaml
      repository: https://github.com/ARMmbed/mbl-core.git
      name: build_hello_world
      from: git
      history: False
      branch: {{ mbl_branch }}
      parameters:
        arm_arch: armv7

    {{ macros.mbl_cli_provisioning() | indent }}

    {{ macros.rstart_cloud_client() | indent }}

- test:
    timeout:
      minutes: 10
    namespace: lxc
    definitions:
    - path: ci/lava/tests/mbl-cli-pelion-upgrade-app.yaml
      repository: https://github.com/ARMmbed/mbl-core.git
      name: pelion-app-update
      from: git
      history: False
      branch: {{ mbl_branch }}

    {{ macros.delete_certificate() | indent }}

{% endblock testplan %}
